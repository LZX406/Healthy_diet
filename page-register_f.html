<!DOCTYPE html>
<html lang="en">

<head>
    <script type="text/javascript" src="assets/js/databaseurl.js"></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="assets/images/eclogo.jpeg"/>
    <!-- Styles -->
    <link href="assets/css/lib/font-awesome.min.css" rel="stylesheet">
    <link href="assets/css/lib/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/lib/helper.css" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
    
    
</head>
<style>
    .coor{
        width: 100%;
        height: 50px;
        background-color: rgb(62, 62, 184);
        color: white;
        display: block;
    }

    .back{
    background-image: url('assets/images/background.jpg');
    background-repeat: no-repeat;
    background-attachment: fixed;  
    background-size: cover;}
</style>

<script>

function returnpage(){
    window.location.href="index.html";
        }

    function showPass(){
        var x = document.getElementById("Password");
        if (x.type === "password") {
            x.type = "text";
        } else {
            x.type = "password";
        }
    }

</script>

<body class="back">

    <div class="unix-login">
        <div class="container-fluid" style="opacity: 0.92;">
            <div class="row justify-content-center">
                <div class="col-lg-6">
                    <div class="login-content">
                        <div class="login-form">                        
                        <div class="login-logo">
                            <a href="page-login_f.html"><img src="assets/images/cover.png"></span></a> <!-- Logo -->
                        </div>
                            <h4>Register</h4>

                                <!-- Username -->
                                <div class="form-group">
                                    <p>Username</p>
                                    <input type="text" class="form-control" id="Username">
                                </div><br>

                                <!-- Email -->
                                <div class="form-group">
                                    <p>Email</p>
                                    <input type="email" class="form-control" id="Email">
                                </div><br>

                                <!-- Password -->
                                <div class="form-group">
                                    <p>Password</p>
                                    <input type="password" class="form-control" id="Password"  required>
                                </div><br>
                                
                                <div class = "form">
                                    <p>Confirm password</p>
                                    <input type="password" class="form-control" id="confirm_Password"  required>
                                </div>

                                <br>
                                <input type="checkbox" onclick="showPass()"><label style="font-size:13px;"> &nbsp;Show Password</label>
                                <br>
                                
                                <!-- Register button -->
                                <button class="coor" id="Register">Register</button>
                                <div class="register-link m-t-15 text-center">
                                    <p>Already have account ? <a href="page-login_f.html"> Sign in</a></p>
                                </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.5.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.5.0/firebase-analytics.js";

        // Initialize Firebase
        const app = initializeApp(connect());
        const analytics = getAnalytics(app); 

        import {getFirestore, doc, getDoc, setDoc, collection, addDoc, updateDoc, deleteDoc, deleteField}
        from "https://www.gstatic.com/firebasejs/9.5.0/firebase-firestore.js";

        const db = getFirestore();

        // ---- Reference ------ //
        let register = document.getElementById("Register");
        let username = document.getElementById("Username");
        let email = document.getElementById("Email");
        let password = document.getElementById("Password");

        // Function for user registration
        async function InsertData()
        {
            var ref = doc(db,"users", username.value);

            const docRef = await setDoc(
                ref, {
                    username: username.value, 
                    email: email.value,
                    password: password.value
                }
            )
            .then(()=>{
                alert("data added successfully");
                returnpage();
            })
            .catch(()=>{
                alert("Unsuccessfully"+error);
            })

            window.setTimeout(function(){returnpage},3000);
        }

        // Validation of the entered information
        async function validation()
        {
            var username = document.getElementById("Username");
            var p = document.getElementById("Password");
            var cp = document.getElementById("confirm_Password");
            var email = document.getElementById("Email");


            if(username.value == '')
            {
                alert("Please fill in the username");
                return false;
            }

            if(email.value == '')
            {
                alert("Please fill in the email");
                return false;
            }

            if (email.value != '')
            {
                if(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email.value))
                {

                }
                else
                {
                    alert("You have entered an invalid email address!")
                    return (false);
                }
            }

            if(p.value == '')
            {
                alert("Please fill in the password");
                return false;
            }
            
            if(cp.value == '')
            {
                alert("Please fill in the confirm");
                return false;
            }

            if(username.value != '')
            {
                var ref = doc(db,"users", username.value);
                const docSnap = await getDoc(ref);

                if(docSnap.exists())
                {
                    if(username.value == docSnap.data().username)
                    {
                        alert("Username is exist");
                    }
                }

                else
                    {
                        if(p.value == cp.value) 
                        {
                            InsertData();
                        } 
                        else 
                        {
                            alert("Password Does Not Match!");
                        }
                    }
            }

        }     

    //----- Assign events to button--------//
    register.addEventListener('click',validation);
        

        
    </script>

</body>

</html>